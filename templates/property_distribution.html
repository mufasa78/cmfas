{% extends "layout.html" %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>About Properties, Flavors, and Meridians
                </h5>
            </div>
            <div class="card-body">
                <p>
                    In traditional Chinese medicine, medicinal materials are classified by three key attributes:
                </p>
                <ul>
                    <li>
                        <strong>Five Properties (五性):</strong> Cold (寒), Hot (热), Warm (温), Cool (凉), and Neutral (平). 
                        These describe the material's effect on the body's temperature balance.
                    </li>
                    <li>
                        <strong>Five Flavors (五味):</strong> Sour (酸), Bitter (苦), Sweet (甘), Spicy (辛), and Salty (咸).
                        These flavors correspond to therapeutic actions and target organs.
                    </li>
                    <li>
                        <strong>Meridian Tropism (归经):</strong> Indicates which organ/meridian system the herb primarily affects,
                        such as Lung, Liver, Heart, Spleen, Kidney, etc.
                    </li>
                </ul>
                <p>
                    Understanding these distributions helps practitioners create balanced prescriptions targeting specific conditions.
                </p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Five Properties Chart -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-thermometer-half me-2"></i>Five Properties Distribution (五性)
                </h5>
            </div>
            <div class="card-body">
                {% if properties %}
                <div class="chart-container small-chart" id="property-chart"></div>
                {% else %}
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>No property data available. Please import medicinal material data with property information.
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Five Flavors Chart -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-utensils me-2"></i>Five Flavors Distribution (五味)
                </h5>
            </div>
            <div class="card-body">
                {% if flavors %}
                <div class="chart-container small-chart" id="flavor-chart"></div>
                {% else %}
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>No flavor data available. Please import medicinal material data with flavor information.
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Meridian Tropism Chart -->
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-project-diagram me-2"></i>Meridian Distribution (归经)
                </h5>
            </div>
            <div class="card-body">
                {% if meridians %}
                <div class="chart-container" id="meridian-chart"></div>
                {% else %}
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>No meridian data available. Please import medicinal material data with meridian information.
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-table me-2"></i>Property, Flavor, and Meridian Data
                </h5>
            </div>
            <div class="card-body">
                <ul class="nav nav-tabs" id="propertyTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="properties-tab" data-bs-toggle="tab" data-bs-target="#properties-content" type="button" role="tab" aria-controls="properties" aria-selected="true">Properties</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="flavors-tab" data-bs-toggle="tab" data-bs-target="#flavors-content" type="button" role="tab" aria-controls="flavors" aria-selected="false">Flavors</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="meridians-tab" data-bs-toggle="tab" data-bs-target="#meridians-content" type="button" role="tab" aria-controls="meridians" aria-selected="false">Meridians</button>
                    </li>
                </ul>
                
                <div class="tab-content p-3" id="propertyTabContent">
                    <!-- Properties Table -->
                    <div class="tab-pane fade show active" id="properties-content" role="tabpanel" aria-labelledby="properties-tab">
                        {% if properties %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Property</th>
                                        <th>Count</th>
                                        <th>Percentage</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% set property_total = properties.values()|sum %}
                                    {% for property, count in properties.items()|sort(reverse=true, attribute='1') %}
                                    <tr>
                                        <td>{{ property }}</td>
                                        <td>{{ count }}</td>
                                        <td>{{ "%.2f"|format(count / property_total * 100) }}%</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <p class="text-muted">No property data available.</p>
                        {% endif %}
                    </div>
                    
                    <!-- Flavors Table -->
                    <div class="tab-pane fade" id="flavors-content" role="tabpanel" aria-labelledby="flavors-tab">
                        {% if flavors %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Flavor</th>
                                        <th>Count</th>
                                        <th>Percentage</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% set flavor_total = flavors.values()|sum %}
                                    {% for flavor, count in flavors.items()|sort(reverse=true, attribute='1') %}
                                    <tr>
                                        <td>{{ flavor }}</td>
                                        <td>{{ count }}</td>
                                        <td>{{ "%.2f"|format(count / flavor_total * 100) }}%</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <p class="text-muted">No flavor data available.</p>
                        {% endif %}
                    </div>
                    
                    <!-- Meridians Table -->
                    <div class="tab-pane fade" id="meridians-content" role="tabpanel" aria-labelledby="meridians-tab">
                        {% if meridians %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Meridian</th>
                                        <th>Count</th>
                                        <th>Percentage</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% set meridian_total = meridians.values()|sum %}
                                    {% for meridian, count in meridians.items()|sort(reverse=true, attribute='1') %}
                                    <tr>
                                        <td>{{ meridian }}</td>
                                        <td>{{ count }}</td>
                                        <td>{{ "%.2f"|format(count / meridian_total * 100) }}%</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <p class="text-muted">No meridian data available.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        {% if properties %}
        // Initialize property chart
        initPropertyChart('property-chart', {{ properties|tojson }});
        {% endif %}
        
        {% if flavors %}
        // Initialize flavor chart
        initFlavorChart('flavor-chart', {{ flavors|tojson }});
        {% endif %}
        
        {% if meridians %}
        // Initialize meridian chart
        initMeridianChart('meridian-chart', {{ meridians|tojson }});
        {% endif %}
    });
</script>
{% endblock %}
